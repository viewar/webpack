language: node_js
node_js:
  - 12
  - 11
  - 10

cache:
  directories:
    - ~/.npm

notifications:
  email: false

env:
  NODE_ENV: test

branches:
  # only:
  #   - master
  #   - next
  except:
    # prevent semantic-release pushed tags, to trigger CI
    - /^v\d+\.\d+\.\d+$/

# before_install:
#   - npm install -g gulp-cli

install: npm install

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start

script:
  - npm run clean
  - npm run lint
  - WEBPACK_PATH=test ./node_modules/karma start ./src/test/karma.config.js --single-run --browsers Firefox
  - npm run build

before_deploy:
  - npm i -g semantic-release
  - npm i -g @semantic-release/commit-analyzer @semantic-release/release-notes-generator @semantic-release/changelog @semantic-release/npm @semantic-release/git @semantic-release/github

deploy:
  provider: script
  skip_cleanup: true
  script: npx semantic-release
  on:
    branch: next
